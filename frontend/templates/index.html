<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=640, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sign Detection System</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="touchscreen">
    <!-- Main Menu (Home Page) -->
    <div id="page-home" class="page active">
        <div class="home-container">
            <div class="home-header">
                <!-- System Control Buttons (Top Left) -->
                <div class="system-controls">
                    <button class="system-btn" id="btn-shutdown-app" title="Shutdown App">
                        <span class="system-icon">‚èª</span>
                    </button>
                    <button class="system-btn" id="btn-shutdown-pi" title="Shutdown Pi">
                        <span class="system-icon">‚èº</span>
                    </button>
                    <button class="system-btn" id="btn-reboot-pi" title="Reboot Pi">
                        <span class="system-icon">‚Üª</span>
                    </button>
                </div>
                
                <div class="status-panel">
                    <div class="status-item" id="status-wifi">
                        <span class="status-icon">üì∂</span>
                        <span class="status-label">WiFi</span>
                        <span class="status-dot dot offline"></span>
                    </div>
                    <div class="status-item" id="status-camera">
                        <span class="status-icon">‚¨§</span>
                        <span class="status-label">Camera</span>
                        <span class="status-dot dot offline"></span>
                    </div>
                </div>
            </div>
            
            <div class="menu-buttons">
                <button class="menu-btn" data-page="live">
                    <span class="icon">‚ñ∂</span>
                    <span class="label">Live Feed</span>
                </button>                            
                
                <button class="menu-btn" data-page="settings">
                    <span class="icon">‚öô</span>
                    <span class="label">Settings</span>
                </button>
                
                <button class="menu-btn" data-page="logs">
                    <span class="icon">‚ò∞</span>
                    <span class="label">Logs</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="app-content">
        <!-- Live Feed Page -->
        <div id="page-live" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()">‚Üê Back</button>
                <h2>Live Feed</h2>
            </div>

            <div class="video-container-compact">
                <canvas id="video-canvas"></canvas>
                <div id="no-feed" class="no-feed">
                </div>
            </div>

            <div class="stats-bar-compact">
                <div class="stat">
                    <span class="label">FPS:</span>
                    <span id="fps-value" class="value">0</span>
                </div>
                <div class="stat">
                    <span class="label">Detected:</span>
                    <span id="detection-count" class="value">0</span>
                </div>
                <div class="stat recording-stat" id="recording-timer" style="display: none;">
                    <span class="label">REC:</span>
                    <span id="recording-time" class="value recording-time">00:00</span>
                </div>
                <button id="btn-record" class="btn-record" title="Start Recording">
                    <span class="record-icon">‚óè</span>
                </button>
            </div>
        </div>
        
        <!-- Driving Mode Page -->
        <div id="page-driving" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()">‚Üê Back</button>
                <h2>Driving Mode</h2>
            </div>
            
            <div class="driving-mode-selector">
                <button class="mode-btn mode-casual" id="btn-casual-mode">
                    <span class="mode-icon">‚öê</span>
                    <span class="mode-title">Casual Mode</span>
                    <span class="mode-desc">Simple detection display</span>
                </button>
                
                <button class="mode-btn mode-gamified" id="btn-gamified-mode">
                    <span class="mode-icon">‚òÖ</span>
                    <span class="mode-title">Gamified Mode</span>
                    <span class="mode-desc">Score & achievements</span>
                </button>
            </div>
        </div>

        <!-- Logs Page -->
        <div id="page-logs" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()">‚Üê Back</button>
                <h2>Violation Logs</h2>
            </div>
            
            <div class="controls-compact">
                <button id="btn-refresh-logs" class="btn btn-primary btn-touch" onclick="loadViolations()">‚Üª Refresh</button>
                <button id="btn-clear-display" class="btn btn-secondary btn-touch" onclick="clearViolationsDisplay()">‚úï Clear</button>
            </div>

            <div class="violations-log-container">
                <div id="violations-list" class="violations-list"></div>
            </div>
            
            <!-- Detail Modal -->
            <div id="violation-detail-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Violation Details</h3>
                        <button class="btn-close" onclick="closeViolationDetail()">‚úï</button>
                    </div>
                    <div id="violation-detail-content" class="modal-body"></div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="page-settings" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()">‚Üê Back</button>
                <h2>Settings</h2>
            </div>
            
            <div class="settings-container-compact">
                <!-- Recordings Section -->
                <div class="settings-group">
                    <h3>üìπ Recordings</h3>
                    <div class="recordings-header">
                        <span id="recordings-count">0 recordings</span>
                        <span id="recordings-size">0 MB</span>
                        <button id="btn-refresh-recordings" class="btn btn-small btn-primary" onclick="loadRecordings()">‚Üª</button>
                    </div>
                    <div id="recordings-list" class="recordings-list">
                        <div class="recordings-empty">No recordings yet</div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Camera</h3>
                    <div class="setting-row">
                        <label>Resolution</label>
                        <select id="setting-resolution" class="select select-touch">
                            <option value="640x480">640x480</option>
                            <option value="800x600">800x600</option>
                            <option value="1280x720">1280x720</option>
                        </select>
                    </div>
                    <div class="setting-row">
                        <label>FPS</label>
                        <select id="setting-fps" class="select select-touch">
                            <option value="15">15</option>
                            <option value="30">30</option>
                            <option value="60">60</option>
                        </select>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>Detection</h3>
                    <div class="setting-row">
                        <label>Confidence</label>
                        <div class="slider-container">
                            <input type="range" id="setting-confidence" class="slider-touch" min="0" max="100" value="50" step="5">
                            <span id="confidence-display" class="slider-value">50%</span>
                        </div>
                    </div>
                </div>

                <div class="controls-compact">
                    <button id="btn-save-settings" class="btn btn-success btn-touch">‚ä° Save</button>
                    <button id="btn-load-settings" class="btn btn-primary btn-touch">‚Üª Reload</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-content modal-confirm">
            <div class="modal-header">
                <h3 id="confirm-title">Confirm Action</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-cancel" class="btn btn-secondary">Cancel</button>
                <button id="confirm-ok" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Video Playback Modal -->
    <div id="video-modal" class="modal" style="display: none;">
        <div class="modal-content modal-video">
            <div class="modal-header">
                <h3 id="video-title">Recording</h3>
                <button class="btn-close" onclick="closeVideoModal()">‚úï</button>
            </div>
            <div class="modal-body video-body">
                <video id="video-player" controls>
                    <source id="video-source" src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
        </div>
    </div>

    <!-- Load SocketIO from CDN -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Load our app -->
    <script src="/static/js/app.js"></script>
</body>
</html>
