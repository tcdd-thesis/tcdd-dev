<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=640, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sign Detection System</title>
    <link rel="stylesheet" href="/static/css/fontawesome-local.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="touchscreen">
    <!-- Brightness Overlay (CSS-based screen dimming) -->
    <div id="brightness-overlay"></div>
    <!-- Main Menu (Home Page) -->
    <div id="page-home" class="page active">
        <div class="home-container">
            <div class="home-header">
                <div class="header-actions">
                    <button class="action-btn closeapp-btn" onclick="showCloseAppConfirm()" title="Close App">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                    <button class="action-btn reboot-btn" onclick="showRebootConfirm()" title="Reboot">
                        <i class="fa-solid fa-rotate"></i>
                    </button>
                    <button class="action-btn shutdown-btn" onclick="showShutdownConfirm()" title="Shutdown">
                        <i class="fa-solid fa-power-off"></i>
                    </button>
                </div>
                <div class="status-panel">
                    <div class="status-item" id="status-wifi">
                        <span id="home-wifi-fallback" class="status-icon-indicator"><i class="fa-solid fa-wifi"></i></span>
                        <span id="home-wifi-signal" class="home-signal-bars" style="display:none;"></span>
                        <span class="status-label">WiFi</span>
                    </div>
                    <div class="status-item" id="status-camera">
                        <span class="status-icon-indicator"><i class="fa-solid fa-video"></i></span>
                        <span class="status-label">Camera</span>
                    </div>
                </div>
            </div>
            
            <div class="menu-buttons">
                <button class="menu-btn" data-page="live">
                    <span class="icon"><i class="fa-solid fa-play"></i></span>
                    <span class="label">Live Feed</span>
                </button>                            
                
                <button class="menu-btn" data-page="settings">
                    <span class="icon"><i class="fa-solid fa-gear"></i></span>
                    <span class="label">Settings</span>
                </button>
                
                <button class="menu-btn" data-page="logs">
                    <span class="icon"><i class="fa-solid fa-list"></i></span>
                    <span class="label">Logs</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="app-content">
        <!-- Live Feed Page -->
        <div id="page-live" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()"><i class="fa-solid fa-arrow-left"></i> Back</button>
                <h2>Live Feed</h2>
            </div>

            <div class="video-container-compact">
                <canvas id="video-canvas"></canvas>
                <div id="no-feed" class="no-feed">
                </div>
            </div>

            <div class="stats-bar-compact">
                <div class="stat">
                    <span class="label">FPS:</span>
                    <span id="fps-value" class="value">0</span>
                </div>
                <div class="stat">
                    <span class="label">Detected:</span>
                    <span id="detection-count" class="value">0</span>
                </div>
            </div>
        </div>
        
        <!-- Driving Mode Page -->
        <div id="page-driving" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()"><i class="fa-solid fa-arrow-left"></i> Back</button>
                <h2>Driving Mode</h2>
            </div>
            
            <div class="driving-mode-selector">
                <button class="mode-btn mode-casual" id="btn-casual-mode">
                    <span class="mode-icon"><i class="fa-solid fa-flag"></i></span>
                    <span class="mode-title">Casual Mode</span>
                    <span class="mode-desc">Simple detection display</span>
                </button>
                
                <button class="mode-btn mode-gamified" id="btn-gamified-mode">
                    <span class="mode-icon"><i class="fa-solid fa-star"></i></span>
                    <span class="mode-title">Gamified Mode</span>
                    <span class="mode-desc">Score & achievements</span>
                </button>
            </div>
        </div>

        <!-- Logs Page -->
        <div id="page-logs" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()"><i class="fa-solid fa-arrow-left"></i> Back</button>
                <h2>Violation Logs</h2>
            </div>
            
            <div class="controls-compact">
                <button id="btn-refresh-logs" class="btn btn-primary btn-touch" onclick="loadViolations()"><i class="fa-solid fa-rotate-right"></i> Refresh</button>
                <button id="btn-clear-display" class="btn btn-secondary btn-touch" onclick="clearViolationsDisplay()"><i class="fa-solid fa-xmark"></i> Clear</button>
            </div>

            <div class="violations-log-container">
                <div id="violations-list" class="violations-list"></div>
            </div>
            
            <!-- Detail Modal -->
            <div id="violation-detail-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Violation Details</h3>
                        <button class="btn-close" onclick="closeViolationDetail()"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <div id="violation-detail-content" class="modal-body"></div>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="page-settings" class="page">
            <div class="page-header">
                <button class="btn-back" onclick="goHome()"><i class="fa-solid fa-arrow-left"></i> Back</button>
                <h2>Settings</h2>
            </div>
            
            <div class="settings-container-compact">
                <div class="settings-group">
                    <h3>Display</h3>
                    <div class="setting-row">
                        <label>Screen Brightness</label>
                        <div class="slider-container">
                            <input type="range" id="setting-brightness" class="slider-touch" min="10" max="100" value="50" step="5">
                            <span id="brightness-display" class="slider-value">50%</span>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>WiFi & Hotspot</h3>
                    <div class="setting-row wifi-status-row">
                        <label>Status</label>
                        <span id="wifi-status-text" class="wifi-status">Checking...</span>
                    </div>
                    <div class="setting-row hotspot-toggle-row">
                        <label>Hotspot</label>
                        <input type="checkbox" id="hotspot-toggle" onchange="toggleHotspotUI(this)">
                        <span id="hotspot-status-text" class="hotspot-status">Checking...</span>
                    </div>
                    <div class="wifi-controls">
                        <button id="btn-wifi-disconnect" class="btn btn-danger btn-touch btn-small" onclick="disconnectWifi()" style="display:none;">
                            <i class="fa-solid fa-link-slash"></i> Disconnect
                        </button>
                        <button id="btn-scan-wifi" class="btn btn-primary btn-touch btn-small" onclick="scanWifiNetworks()">
                            <i class="fa-solid fa-magnifying-glass"></i> Scan
                        </button>
                    </div>
                    <div id="wifi-networks-list" class="wifi-networks-list" style="display:none;">
                        <!-- Networks will be populated by JavaScript -->
                    </div>
                    <div id="wifi-saved-section" style="margin-top: 10px;">
                        <div class="setting-row" style="cursor: pointer;" onclick="toggleSavedNetworks()">
                            <label>Saved Networks</label>
                            <span id="saved-networks-toggle"><i class="fa-solid fa-chevron-down"></i></span>
                        </div>
                        <div id="wifi-saved-list" class="wifi-saved-list" style="display:none;">
                            <!-- Saved networks will be populated by JavaScript -->
                        </div>
                    </div>
    <!-- Hotspot Prompt Modal -->
    <div id="hotspot-prompt-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Enable Hotspot</h3>
                <button class="btn-close" onclick="closeHotspotPrompt()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <p>This will disconnect WiFi to start the hotspot. Proceed?</p>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-secondary btn-touch" onclick="closeHotspotPrompt()">Cancel</button>
                    <button class="btn btn-success btn-touch" onclick="confirmHotspotEnable()">Enable Hotspot</button>
                </div>
            </div>
        </div>
    </div>
                </div>

                <div class="settings-group">
                    <h3>Detection</h3>
                    <div class="setting-row">
                        <label>Confidence</label>
                        <div class="slider-container">
                            <input type="range" id="setting-confidence" class="slider-touch" min="0" max="100" value="50" step="5">
                            <span id="confidence-display" class="slider-value">50%</span>
                        </div>
                    </div>
                </div>

                <div class="settings-group">
                    <h3>System</h3>
                    <div class="setting-row">
                        <label>Version</label>
                        <span class="setting-value">1.0.0</span>
                    </div>
                    <div class="setting-row">
                        <label>Device</label>
                        <span class="setting-value">Raspberry Pi 5</span>
                    </div>
                </div>

                <div class="controls-compact">
                    <button id="btn-reset-settings" class="btn btn-secondary btn-touch"><i class="fa-solid fa-rotate-left"></i> Reset</button>
                    <button id="btn-save-settings" class="btn btn-success btn-touch"><i class="fa-solid fa-floppy-disk"></i> Save</button>
                </div>
                
                <!-- Spacer to ensure content is scrollable -->
                <div style="height: 50px;"></div>
            </div>
        </div>
    </main>

    <!-- WiFi Password Modal -->
    <div id="wifi-password-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connect to WiFi</h3>
                <button class="btn-close" onclick="closeWifiModal()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <p id="wifi-connect-ssid" style="margin-bottom: 10px; font-weight: bold;"></p>
                <input type="password" id="wifi-password-input" class="input-touch" placeholder="Enter password" autocomplete="off">
                <div class="wifi-modal-buttons" style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-secondary btn-touch" onclick="closeWifiModal()">Cancel</button>
                    <button class="btn btn-success btn-touch" onclick="submitWifiPassword()">Connect</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Shutdown Confirmation Modal -->
    <div id="shutdown-confirm-modal" class="modal shutdown-modal">
        <div class="modal-content shutdown-confirm-content">
            <div class="modal-header">
                <h3>Shutdown System?</h3>
            </div>
            <div class="modal-body shutdown-confirm-body">
                <p>Are you sure you want to shut down the Raspberry Pi?</p>
                <div class="shutdown-confirm-buttons">
                    <button class="btn btn-secondary btn-touch" onclick="cancelShutdown()">Cancel</button>
                    <button class="btn btn-danger btn-touch" onclick="confirmShutdown()">Shutdown</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shutdown In Progress Modal -->
    <div id="shutdown-progress-modal" class="modal shutdown-modal">
        <div class="modal-content shutdown-progress-content">
            <div class="shutdown-progress-icon"><i class="fa-solid fa-power-off"></i></div>
            <div class="shutdown-progress-text">Shutting down...</div>
        </div>
    </div>

    <!-- Reboot Confirmation Modal -->
    <div id="reboot-confirm-modal" class="modal reboot-modal">
        <div class="modal-content reboot-confirm-content">
            <div class="modal-header">
                <h3>Restart System?</h3>
            </div>
            <div class="modal-body reboot-confirm-body">
                <p>Are you sure you want to restart the Raspberry Pi?</p>
                <div class="reboot-confirm-buttons">
                    <button class="btn btn-secondary btn-touch" onclick="cancelReboot()">Cancel</button>
                    <button class="btn btn-reboot btn-touch" onclick="confirmReboot()">Restart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reboot In Progress Modal -->
    <div id="reboot-progress-modal" class="modal reboot-modal">
        <div class="modal-content reboot-progress-content">
            <div class="reboot-progress-icon"><i class="fa-solid fa-rotate"></i></div>
            <div class="reboot-progress-text">Restarting...</div>
        </div>
    </div>

    <!-- Close App Confirmation Modal -->
    <div id="closeapp-confirm-modal" class="modal closeapp-modal">
        <div class="modal-content closeapp-confirm-content">
            <div class="modal-header">
                <h3>Close the application?</h3>
            </div>
            <div class="modal-body closeapp-confirm-body">
                <p>This will stop the detection system and close the browser.</p>
                <div class="closeapp-confirm-buttons">
                    <button class="btn btn-secondary btn-touch" onclick="cancelCloseApp()">Cancel</button>
                    <button class="btn btn-closeapp btn-touch" onclick="confirmCloseApp()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Close App In Progress Modal -->
    <div id="closeapp-progress-modal" class="modal closeapp-modal">
        <div class="modal-content closeapp-progress-content">
            <div class="closeapp-progress-icon"><i class="fa-solid fa-xmark"></i></div>
            <div class="closeapp-progress-text">Closing application...</div>
        </div>
    </div>

    <!-- Unsaved Settings Modal -->
    <div id="unsaved-settings-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Unsaved Changes</h3>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">You have unsaved settings changes. What would you like to do?</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-success btn-touch" onclick="saveSettingsAndGoHome()">
                        <i class="fa-solid fa-check"></i> Save
                    </button>
                    <button class="btn btn-danger btn-touch" onclick="discardSettingsAndGoHome()">
                        <i class="fa-solid fa-trash"></i> Discard
                    </button>
                    <button class="btn btn-secondary btn-touch" onclick="cancelUnsavedSettings()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Load SocketIO from CDN -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- Load our app -->
    <script src="/static/js/app.js"></script>
</body>
</html>
